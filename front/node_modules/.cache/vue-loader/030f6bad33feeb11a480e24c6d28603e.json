{"remainingRequest":"C:\\Users\\multicampus\\Desktop\\Sub PJT III\\s02p12b103\\fooddeuk\\front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\multicampus\\Desktop\\Sub PJT III\\s02p12b103\\fooddeuk\\front\\src\\components\\common\\Request.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\multicampus\\Desktop\\Sub PJT III\\s02p12b103\\fooddeuk\\front\\src\\components\\common\\Request.vue","mtime":1581296585758},{"path":"C:\\Users\\multicampus\\Desktop\\Sub PJT III\\s02p12b103\\fooddeuk\\front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\multicampus\\Desktop\\Sub PJT III\\s02p12b103\\fooddeuk\\front\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\multicampus\\Desktop\\Sub PJT III\\s02p12b103\\fooddeuk\\front\\node_modules\\vuetify-loader\\lib\\loader.js","mtime":1574476662000},{"path":"C:\\Users\\multicampus\\Desktop\\Sub PJT III\\s02p12b103\\fooddeuk\\front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\multicampus\\Desktop\\Sub PJT III\\s02p12b103\\fooddeuk\\front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7bWFwU3RhdGV9IGZyb20gJ3Z1ZXgnOwppbXBvcnQgaHR0cCBmcm9tICcuLi8uLi8uLi9odHRwLWNvbW1vbicKaW1wb3J0IFZ1ZSBmcm9tICd2dWUnCmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JwppbXBvcnQgVnVlTW9tZW50SlMgZnJvbSAndnVlLW1vbWVudGpzJwppbXBvcnQgeyBmaXJlREIgfSBmcm9tICcuLi8uLi9tYWluJzsKaW1wb3J0IEV2ZW50QnVzIGZyb20gJy4uLy4uL0V2ZW50QnVzJwppbXBvcnQgeyBmaXJlc3RvcmUgfSBmcm9tICdmaXJlYmFzZSc7CgpWdWUudXNlKFZ1ZU1vbWVudEpTLCBtb21lbnQpCgoKZXhwb3J0IGRlZmF1bHQgewogIGNyZWF0ZWQoKSAgewogICAgbW9tZW50LmxvY2FsZSgna28nKTsKICAgIGlmKHRoaXMuJHN0b3JlLnN0YXRlLnVzZXJpbmZvIT1udWxsKSB7CiAgICAgIHRoaXMuZW1haWwgPSB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyaW5mby5lbWFpbDsKICAgICAgdGhpcy5uaWNrbmFtZSA9IHRoaXMuJHN0b3JlLnN0YXRlLnVzZXJpbmZvLm5pY2tOYW1lOwogICAgfQogICAgLy8gdGhpcy5nZXRBbGFybXMoKTsKICAgIHRoaXMud2F0Y2hBbGFybUZyb21GaXJlYmFzZSgpOwogIH0sCiAgbW91bnRlZCA6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5lbWl0UmVxdWVzdCgpOwogIH0sCiAgbWV0aG9kcyA6IHsKICAgIGVtaXRSZXF1ZXN0KCkgewogICAgICBsZXQgd2hvYW1pID0gdGhpczsKICAgICAgRXZlbnRCdXMuJG9uKCdlbWl0UmVxdWVzdCcsIGZ1bmN0aW9uKCkgewogICAgICAgIC8vIGFsZXJ0KCJlbWl0UmVxdWVzdCDqsJDsp4AiKQogICAgICAgIHdob2FtaS5nZXRBbGFybXMoKTsKICAgICAgfSkKICAgIH0sCiAgICBzZXRBbGFybShhbGFybSkgewogICAgICB0aGlzLmFsYXJtQ291bnQgPSBhbGFybTsKICAgIH0sCiAgICB1cEFsYXJtVG9GaXJlYmFzZShlbWFpbCkgewogICAgICBmaXJlREIuY29sbGVjdGlvbignQWxhcm0nKS5kb2MoZW1haWwpCiAgICAgIC51cGRhdGUoewogICAgICAgIGNvdW50IDogZmlyZXN0b3JlLkZpZWxkVmFsdWUuaW5jcmVtZW50KDEpCiAgICAgIH0pCiAgICB9LAogICAgZG93bkFsYXJtVG9GaXJlYmFzZSgpIHsKICAgICAgLy8gYWxlcnQoImRvd24iKQogICAgICBmaXJlREIuY29sbGVjdGlvbignQWxhcm0nKS5kb2ModGhpcy5lbWFpbCkKICAgICAgLnNldCh7CiAgICAgICAgY291bnQgOiB0aGlzLmFsYXJtQ291bnQgLSAxCiAgICAgIH0pCiAgICB9LAogICAgd2F0Y2hBbGFybUZyb21GaXJlYmFzZSgpIHsKICAgICAgICBsZXQgd2hvYW1pID0gdGhpczsKICAgICAgICBsZXQgY291bnQ9MDsKICAgICAgICBmaXJlREIuY29sbGVjdGlvbignQWxhcm0nKS5kb2ModGhpcy5lbWFpbCkub25TbmFwc2hvdCggewogICAgICAgICAgICBpbmNsdWRlTWV0YWRhdGFDaGFuZ2VzOiB0cnVlICAgIAogICAgICAgIH0sZnVuY3Rpb24oZG9jKSB7CiAgICAgICAgICAgIGlmKGRvYy5kYXRhKCk9PXVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgY291bnQgPSAwOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY291bnQgPSBkb2MuZGF0YSgpLmNvdW50OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdob2FtaS5zZXRBbGFybShjb3VudCk7CiAgICAgICAgICAgIHdob2FtaS5nZXRBbGFybXMoKTsKICAgICAgICB9KQogICAgfSwKICAgIGdldFRpbWUodGltZSkgewogICAgICByZXR1cm4gbW9tZW50KHRpbWUpLmZyb21Ob3coKTsKICAgIH0sCiAgICBnZXRBbGFybXMoKSB7CiAgICAgIGh0dHAuZ2V0KCIvZm9sbG93L3JlcXVlc3RsaXN0P215bmlja25hbWU9IiArIHRoaXMubmlja25hbWUpCiAgICAgIC50aGVuKFJlc3BvbnNlID0+IHsKICAgICAgICB0aGlzLml0ZW1zID0gUmVzcG9uc2UuZGF0YQogICAgICAgIC8vIGNvbnNvbGUubG9nKFJlc3BvbnNlLmRhdGEpCiAgICAgIH0pCiAgICAgIC5jYXRjaChFcnJvciA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhFcnJvcikKICAgICAgfSkKICAgIH0sCiAgICBnZXRVc2VyQnlOaWNrbmFtZShuaWNrKSB7CiAgICAgICAgbGV0IGZvcm0gPSBuZXcgRm9ybURhdGEoKQogICAgICAgIGZvcm0uYXBwZW5kKCduaWNrbmFtZScsIG5pY2spCiAgICAgICAgaHR0cC5nZXQoIi91c2VyL3VzZXJpbmZvL3tuaWNrbmFtZX0/bmlja25hbWU9IituaWNrKQogICAgICAgIC50aGVuKFJlc3BvbnNlID0+IHsKICAgICAgICAgIGxldCBvdGhlckVtYWlsID0gUmVzcG9uc2UuZGF0YS5lbWFpbDsKICAgICAgICAgIHRoaXMudXBBbGFybVRvRmlyZWJhc2Uob3RoZXJFbWFpbCk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goRXJyb3IgPT4gewogICAgICAgICAgICBjb25zb2xlLmxvZyhFcnJvcikKICAgICAgICB9KQogICAgfSwKICAgIGFjY2VwdChudW0sIG90aGVyTmlja25hbWUpIHsKICAgICAgbGV0IGZvcm0gPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICAKICAgICAgZm9ybS5hcHBlbmQoJ251bScsIG51bSkKICAgICAgZm9ybS5hcHBlbmQoJ25pY2tuYW1lJywgdGhpcy5uaWNrbmFtZSkKICAgICAgZm9ybS5hcHBlbmQoJ215bmlja25hbWUnLCBvdGhlck5pY2tuYW1lKQogICAgICBmb3JtLmFwcGVuZCgnYWdyZWUnLCAnMScpCiAgICAgIGh0dHAucG9zdCgiL2ZvbGxvdy9mb2xsb3dhZ3JlZSIsIGZvcm0pCiAgICAgIC50aGVuKFJlc3BvbnNlID0+IHsKICAgICAgICB0aGlzLmlzZm9sbG93ID0gMTsKICAgICAgICAvLyBjb25zb2xlLmxvZyhSZXNwb25zZS5kYXRhKQogICAgICAgIHRoaXMuZ2V0QWxhcm1zKCk7CiAgICAgIH0pCiAgICAgIC5jYXRjaChFcnJvciA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhFcnJvcikKICAgICAgfSkKICAgIH0sCiAgICBkZW55KG51bSwgb3RoZXJOaWNrbmFtZSkgewogICAgICBsZXQgZm9ybSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICAgIAogICAgICBmb3JtLmFwcGVuZCgnbnVtJywgbnVtKQogICAgICBmb3JtLmFwcGVuZCgnbmlja25hbWUnLCB0aGlzLm5pY2tuYW1lKQogICAgICBmb3JtLmFwcGVuZCgnbXluaWNrbmFtZScsIG90aGVyTmlja25hbWUpCiAgICAgIGZvcm0uYXBwZW5kKCdhZ3JlZScsICcwJykKICAgICAgaHR0cC5wb3N0KCIvZm9sbG93L2ZvbGxvd2FncmVlIiwgZm9ybSkKICAgICAgLnRoZW4oUmVzcG9uc2UgPT4gewogICAgICAgIC8vIGNvbnNvbGUubG9nKFJlc3BvbnNlLmRhdGEpCiAgICAgICAgdGhpcy5nZXRBbGFybXMoKTsKICAgICAgICB0aGlzLmRvd25BbGFybVRvRmlyZWJhc2UoKTsKICAgICAgICB0aGlzLmdldFVzZXJCeU5pY2tuYW1lKG90aGVyTmlja25hbWUpOyAgICAgICAgICAKICAgICAgfSkKICAgICAgLmNhdGNoKEVycm9yID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKEVycm9yKQogICAgICB9KQogICAgfQogIH0sCiAgZGF0YTogKCkgPT4gKHsKICAgIGVtYWlsIDogJycsCiAgICBuaWNrbmFtZTonJywKICAgIGl0ZW1zOiBbXSwKICAgIGFsYXJtQ291bnQgOiAwLAogIH0pLAogIGNvbXB1dGVkIDogewogICAgICAuLi5tYXBTdGF0ZShbJ3VzZXJpbmZvJ10pLAogIH0KfQo="},{"version":3,"sources":["Request.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Request.vue","sourceRoot":"src/components/common","sourcesContent":["<template>\r\n  <v-card\r\n    class=\"mx-auto\"\r\n  >\r\n    <div v-if=\"items.length==0\">\r\n      요청이 없습니다.\r\n    </div>\r\n    <v-list v-if=\"items.length!=0\" three-line>\r\n      <template  v-for=\"(item, index) in items\">\r\n        <v-subheader\r\n          v-if=\"item.header\"\r\n          :key=\"item.header\"\r\n          v-text=\"item.header\"\r\n        ></v-subheader>\r\n\r\n        <v-divider\r\n          v-else-if=\"item.divider\"\r\n          :key=\"index\"\r\n          :inset=\"item.inset\"\r\n        ></v-divider>\r\n\r\n        <v-list-item\r\n          v-else\r\n          :key=\"item.title\"\r\n        >\r\n          <v-list-item-avatar>\r\n            <v-img :src=\"item.avatar\"></v-img>\r\n          </v-list-item-avatar>\r\n\r\n          <v-list-item-content style=\"margin-left:20px;\">\r\n            <v-list-item-title>\"{{item.sender}}\"님이 팔로우 신청을 했습니다.</v-list-item-title>\r\n            <v-list-item-subtitle>{{getTime(item.date)}}</v-list-item-subtitle>\r\n            <v-btn small dark style=\"margin-right:20px; background-color:#a4c2f4ff; color:#ffffff\" @click=\"accept(item.num, item.sender)\">승인</v-btn>\r\n            <v-btn small dark style=\"background-color:#e06666ff; color:#ffffff\" @click=\"deny(item.num, item.sender)\">거절</v-btn>\r\n          </v-list-item-content>\r\n        </v-list-item>\r\n      </template>\r\n    </v-list>\r\n  </v-card>\r\n</template>\r\n\r\n<script>\r\n  import {mapState} from 'vuex';\r\n  import http from '../../../http-common'\r\n  import Vue from 'vue'\r\n  import moment from 'moment'\r\n  import VueMomentJS from 'vue-momentjs'\r\n  import { fireDB } from '../../main';\r\n  import EventBus from '../../EventBus'\r\n  import { firestore } from 'firebase';\r\n\r\n  Vue.use(VueMomentJS, moment)\r\n\r\n\r\n  export default {\r\n    created()  {\r\n      moment.locale('ko');\r\n      if(this.$store.state.userinfo!=null) {\r\n        this.email = this.$store.state.userinfo.email;\r\n        this.nickname = this.$store.state.userinfo.nickName;\r\n      }\r\n      // this.getAlarms();\r\n      this.watchAlarmFromFirebase();\r\n    },\r\n    mounted : function() {\r\n      this.emitRequest();\r\n    },\r\n    methods : {\r\n      emitRequest() {\r\n        let whoami = this;\r\n        EventBus.$on('emitRequest', function() {\r\n          // alert(\"emitRequest 감지\")\r\n          whoami.getAlarms();\r\n        })\r\n      },\r\n      setAlarm(alarm) {\r\n        this.alarmCount = alarm;\r\n      },\r\n      upAlarmToFirebase(email) {\r\n        fireDB.collection('Alarm').doc(email)\r\n        .update({\r\n          count : firestore.FieldValue.increment(1)\r\n        })\r\n      },\r\n      downAlarmToFirebase() {\r\n        // alert(\"down\")\r\n        fireDB.collection('Alarm').doc(this.email)\r\n        .set({\r\n          count : this.alarmCount - 1\r\n        })\r\n      },\r\n      watchAlarmFromFirebase() {\r\n          let whoami = this;\r\n          let count=0;\r\n          fireDB.collection('Alarm').doc(this.email).onSnapshot( {\r\n              includeMetadataChanges: true    \r\n          },function(doc) {\r\n              if(doc.data()==undefined) {\r\n                  count = 0;\r\n              } else {\r\n                  count = doc.data().count;\r\n              }\r\n              whoami.setAlarm(count);\r\n              whoami.getAlarms();\r\n          })\r\n      },\r\n      getTime(time) {\r\n        return moment(time).fromNow();\r\n      },\r\n      getAlarms() {\r\n        http.get(\"/follow/requestlist?mynickname=\" + this.nickname)\r\n        .then(Response => {\r\n          this.items = Response.data\r\n          // console.log(Response.data)\r\n        })\r\n        .catch(Error => {\r\n            console.log(Error)\r\n        })\r\n      },\r\n      getUserByNickname(nick) {\r\n          let form = new FormData()\r\n          form.append('nickname', nick)\r\n          http.get(\"/user/userinfo/{nickname}?nickname=\"+nick)\r\n          .then(Response => {\r\n            let otherEmail = Response.data.email;\r\n            this.upAlarmToFirebase(otherEmail);\r\n          })\r\n          .catch(Error => {\r\n              console.log(Error)\r\n          })\r\n      },\r\n      accept(num, otherNickname) {\r\n        let form = new FormData();\r\n          \r\n        form.append('num', num)\r\n        form.append('nickname', this.nickname)\r\n        form.append('mynickname', otherNickname)\r\n        form.append('agree', '1')\r\n        http.post(\"/follow/followagree\", form)\r\n        .then(Response => {\r\n          this.isfollow = 1;\r\n          // console.log(Response.data)\r\n          this.getAlarms();\r\n        })\r\n        .catch(Error => {\r\n            console.log(Error)\r\n        })\r\n      },\r\n      deny(num, otherNickname) {\r\n        let form = new FormData();\r\n          \r\n        form.append('num', num)\r\n        form.append('nickname', this.nickname)\r\n        form.append('mynickname', otherNickname)\r\n        form.append('agree', '0')\r\n        http.post(\"/follow/followagree\", form)\r\n        .then(Response => {\r\n          // console.log(Response.data)\r\n          this.getAlarms();\r\n          this.downAlarmToFirebase();\r\n          this.getUserByNickname(otherNickname);          \r\n        })\r\n        .catch(Error => {\r\n            console.log(Error)\r\n        })\r\n      }\r\n    },\r\n    data: () => ({\r\n      email : '',\r\n      nickname:'',\r\n      items: [],\r\n      alarmCount : 0,\r\n    }),\r\n    computed : {\r\n        ...mapState(['userinfo']),\r\n    }\r\n  }\r\n</script>"]}]}